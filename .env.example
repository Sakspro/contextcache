# ContextCache Environment Configuration
# Copy this file to .env.local and fill in your values
# NEVER commit .env.local to version control

# =============================================================================
# ENVIRONMENT
# =============================================================================
NODE_ENV=development
PYTHON_ENV=development

# =============================================================================
# DATABASE (Neon Postgres)
# =============================================================================
# Format: postgresql://user:password@host:port/database?sslmode=require
DATABASE_URL=postgresql://user:password@localhost:5432/contextcache_dev
# For production (Neon):
# DATABASE_URL=postgresql://user:password@ep-xxx.us-east-2.aws.neon.tech/contextcache?sslmode=require

# Connection pool settings
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=10
DATABASE_POOL_TIMEOUT=30

# =============================================================================
# REDIS (Upstash)
# =============================================================================
REDIS_URL=redis://localhost:6379
# For production (Upstash):
# REDIS_URL=rediss://default:YOUR_TOKEN@your-endpoint.upstash.io:6379

# Rate limiting
REDIS_RATE_LIMIT_ENABLED=true

# =============================================================================
# API CONFIGURATION
# =============================================================================
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4
API_RELOAD=true

# CORS origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# API keys for internal services (generate with: openssl rand -hex 32)
API_INTERNAL_KEY=your-internal-api-key-here

# =============================================================================
# FRONTEND CONFIGURATION
# =============================================================================
NEXT_PUBLIC_API_URL=http://localhost:8000
NEXT_PUBLIC_APP_ENV=development

# Feature flags
NEXT_PUBLIC_ENABLE_ANALYTICS=false
NEXT_PUBLIC_ENABLE_EXPORT=true
NEXT_PUBLIC_ENABLE_GRAPH_VIEW=true

# =============================================================================
# CRYPTOGRAPHY
# =============================================================================
# Argon2id settings for key derivation
ARGON2_TIME_COST=3
ARGON2_MEMORY_COST=65536
ARGON2_PARALLELISM=4

# Security
REQUIRE_STRONG_PASSPHRASES=true
MIN_PASSPHRASE_LENGTH=20

# =============================================================================
# MCP SERVERS
# =============================================================================
MCP_DOCS_SERVER_PORT=8001
MCP_EXTRACTOR_SERVER_PORT=8002
MCP_MEMORY_SERVER_PORT=8003
MCP_AUDIT_SERVER_PORT=8004
MCP_POLICY_GATE_PORT=8005

# Document fetching limits
MAX_DOCUMENT_SIZE_MB=50
ALLOWED_DOMAINS=example.com,arxiv.org,wikipedia.org
FETCH_TIMEOUT_SECONDS=30

# =============================================================================
# RATE LIMITING
# =============================================================================
# Per-project limits (requests per minute)
RATE_LIMIT_LIGHT_READ=120
RATE_LIMIT_INGEST=30
RATE_LIMIT_EXTRACT=30

# Per-IP limits (requests per minute)
RATE_LIMIT_IP_GLOBAL=300

# Proof-of-Work challenge threshold
POW_ENABLED=false
POW_DIFFICULTY=4

# =============================================================================
# WORKER / BACKGROUND JOBS
# =============================================================================
WORKER_CONCURRENCY=4
WORKER_MAX_JOBS_PER_WORKER=50

# Job timeouts (seconds)
JOB_TIMEOUT_RANK=300
JOB_TIMEOUT_DECAY=60
JOB_TIMEOUT_VERIFY=120

# =============================================================================
# STORAGE
# =============================================================================
# Storage adapter: postgres or sqlite
STORAGE_ADAPTER=postgres

# SQLite (local-only encrypted mode)
SQLITE_PATH=./data/contextcache.db
SQLITE_ENCRYPTED=true

# =============================================================================
# ANALYZERS / RANKING
# =============================================================================
# Active analyzer plug-in
ACTIVE_ANALYZER=ppr_time_decay

# PageRank settings
PAGERANK_DAMPING=0.85
PAGERANK_MAX_ITERATIONS=100
PAGERANK_TOLERANCE=1e-6

# Time decay settings
DECAY_HALF_LIFE_DAYS=90
DECAY_ENABLED=true

# =============================================================================
# LOGGING
# =============================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE=./logs/contextcache.log

# Structured logging
ENABLE_STRUCTURED_LOGS=true
LOG_SQL_QUERIES=false

# =============================================================================
# MONITORING & OBSERVABILITY
# =============================================================================
ENABLE_METRICS=true
METRICS_PORT=9090

# Sentry (optional)
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=0.1

# =============================================================================
# CLOUD DEPLOYMENT (Production only)
# =============================================================================
# Google Cloud Run
GCP_PROJECT_ID=your-project-id
GCP_REGION=us-central1
CLOUD_RUN_SERVICE_NAME=contextcache-api

# Secret Manager (production)
USE_SECRET_MANAGER=false
SECRET_MANAGER_PROJECT=your-project-id

# =============================================================================
# CLOUDFLARE PAGES (Frontend deployment)
# =============================================================================
CF_ACCOUNT_ID=
CF_API_TOKEN=
CF_PAGES_PROJECT=contextcache-frontend

# =============================================================================
# TESTING
# =============================================================================
TEST_DATABASE_URL=postgresql://user:password@localhost:5432/contextcache_test
TEST_REDIS_URL=redis://localhost:6379/1

# Test data generation
HYPOTHESIS_PROFILE=dev
HYPOTHESIS_MAX_EXAMPLES=100

# =============================================================================
# DEVELOPMENT TOOLS
# =============================================================================
# Auto-reload
WATCHFILES_FORCE_POLLING=false

# Debug mode
DEBUG=false
VERBOSE_ERRORS=true

# Playwright (E2E tests)
PLAYWRIGHT_HEADLESS=true
PLAYWRIGHT_SLOWMO=0

# =============================================================================
# OPTIONAL: EVALUATION (Databricks)
# =============================================================================
DATABRICKS_HOST=
DATABRICKS_TOKEN=
MLFLOW_TRACKING_URI=databricks
MLFLOW_EXPERIMENT_NAME=/contextcache/eval

# =============================================================================
# OPTIONAL: EXTERNAL SERVICES
# =============================================================================
# OpenAI (if using for embeddings/LLM features)
OPENAI_API_KEY=

# Anthropic (if using Claude)
ANTHROPIC_API_KEY=

# Turnstile (optional, for public demo abuse prevention)
TURNSTILE_SITE_KEY=
TURNSTILE_SECRET_KEY=